# Админ-панель

## Обзор

Админ-панель предоставляет интерфейс для управления данными приложения, включая:
- Управление мышечными группами
- Управление упражнениями
- Другие административные функции

## Архитектура

Административные компоненты реализованы с учетом оптимизации производительности и соответствия принципам Feature-Sliced Design.

### Структура директорий

```
app/
  admin/
    layout.tsx         # Общий лейаут для всех страниц админ-панели
    page.tsx           # Главная страница админ-панели
    muscle_groups/     # Управление мышечными группами
      page.tsx         # Страница создания/редактирования мышечных групп
    exercises/         # Управление упражнениями
      page.tsx         # Страница создания/редактирования упражнений
```

## Ленивая загрузка и Code Splitting

Все компоненты админ-панели загружаются лениво с использованием `dynamic` импорта из Next.js, что предотвращает включение административного кода в основной бандл для обычных пользователей.

### Техническая реализация

В каждом файле страницы админ-панели:

1. Компонент с основным содержимым определяется в том же файле
2. Затем этот компонент оборачивается в `dynamic` импорт
3. Страница экспортирует компонент, возвращающий динамически импортированное содержимое

```tsx
// Типичная структура файла в админ-панели

'use client' // Для клиентских компонентов

import dynamic from 'next/dynamic'

// Компонент с основным содержимым
const PageContent = () => {
  // Реализация компонента
  return (...)
}

// Динамический импорт для code splitting
const DynamicContent = dynamic(() => Promise.resolve(PageContent), {
  loading: () => <div className="flex justify-center p-4">Loading...</div>,
  ssr: false, // Отключаем SSR для клиентских компонентов
})

// Компонент, который экспортируется из файла
const AdminPage = () => {
  return <DynamicContent />
}

export default AdminPage
```

### SSR и CSR

- Для страниц с серверным рендерингом используется `ssr: true`
- Для клиентских компонентов с 'use client' используется `ssr: false`

## Контроль доступа

Доступ к админ-панели контролируется через middleware:

```tsx
// middleware.ts (фрагмент)
if (request.nextUrl.pathname.startsWith('/admin')) {
  if (!accessToken) {
    return NextResponse.redirect(new URL(APP_ROUTES.AUTH.LOGIN, request.url))
  }
  // Дополнительная проверка прав админа может быть добавлена здесь
  return NextResponse.next()
}
```

Для обеспечения безопасности, все пути админ-панели добавлены в конфигурацию middleware:

```tsx
export const config = {
  matcher: [
    // Другие пути
    '/admin/:path*',
  ],
}
```

## Рекомендации по разработке

При разработке новых функций админ-панели:

1. Следуйте шаблону ленивой загрузки для всех новых страниц
2. Размещайте компоненты, специфичные для админ-панели, внутри директории `/app/admin`
3. Для общих компонентов, используемых и в админ-панели и в основном приложении, следуйте структуре FSD и размещайте их в соответствующих слоях (`entities`, `features`, `shared`)
4. Рекомендуется использовать клиентские компоненты ('use client') только где это необходимо, предпочитая серверные компоненты 